import{r as n,j as i}from"./index-BD3d5znr.js";import{u as R,a as z,B as l,S as p}from"./App-CRm83t4Y.js";import{S as u,$ as g,V as A,M as v,a as L,p as T,r as F}from"./Videocam-BdKWiyeo.js";const O=()=>{const D=R(),{state:j,updateSettings:k,initializeSdk:w}=z(),[t,c]=n.useState(j.settings),[m,b]=n.useState([]),o=n.useRef(null),r=n.useRef(null),[y,S]=n.useState(!1),[h,x]=n.useState(!1),f=n.useCallback(async()=>{try{x(!0),r.current&&r.current.getTracks().forEach(s=>s.stop());const e=await navigator.mediaDevices.getUserMedia({video:t.videoDeviceId?{deviceId:t.videoDeviceId}:!0,audio:t.audioDeviceId?{deviceId:t.audioDeviceId}:!0});r.current=e,o.current&&(o.current.srcObject=e);const a=await navigator.mediaDevices.enumerateDevices();b(a);const d=a.filter(s=>s.kind==="videoinput"),I=a.filter(s=>s.kind==="audioinput");d.length>0&&!t.videoDeviceId&&c(s=>({...s,videoDeviceId:d[0].deviceId})),I.length>0&&!t.audioDeviceId&&c(s=>({...s,audioDeviceId:I[0].deviceId}))}catch(e){console.error("Failed to load devices or stream:",e)}finally{x(!1)}},[t.videoDeviceId,t.audioDeviceId]),C=async e=>{r.current&&r.current.getTracks().forEach(d=>d.stop());const a=await navigator.mediaDevices.getUserMedia({video:{deviceId:e},audio:{deviceId:t.audioDeviceId}});r.current=a,o.current&&(o.current.srcObject=a)},M=async e=>{try{r.current&&r.current.getTracks().forEach(d=>d.stop());const a=await navigator.mediaDevices.getUserMedia({video:t.videoDeviceId?{deviceId:t.videoDeviceId}:!0,audio:{deviceId:e}});r.current=a,o.current&&(o.current.srcObject=a),c(d=>({...d,audioDeviceId:e}))}catch(a){console.error("Failed to switch audio device:",a)}};n.useEffect(()=>(f(),()=>{r.current&&r.current.getTracks().forEach(e=>e.stop())}),[f]);const E=async()=>{if(!t.token.trim()){alert("Please enter a meeting token.");return}S(!0),k(t),await w({token:t.token,role:t.role,videoInputDeviceId:t.videoDeviceId,audioInputDeviceId:t.audioDeviceId}),D("/room")};return i.jsx(l,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:i.jsxs(u,{direction:"row",sx:{maxWidth:1024,width:"100%"},gap:3,alignItems:"center",children:[i.jsxs(u,{alignItems:"center",justifyContent:"center",gap:3,sx:{flex:.7},children:[i.jsx(l,{sx:{position:"relative",height:"100%",aspectRatio:"16/9",width:"100%"},children:i.jsx("video",{ref:o,autoPlay:!0,muted:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"16px",backgroundColor:"#000",transform:"scaleX(-1)"}})}),i.jsxs(u,{direction:"row",gap:2,sx:{maxWidth:"32.8125rem",width:"100%"},children:[i.jsx(l,{sx:{width:"32%",display:"flex"},children:i.jsx(g,{size:"small",value:t.videoDeviceId||"",onChange:e=>C(e.target.value),disabled:h,startAdornment:i.jsx(p,{children:i.jsx(A,{sx:{fontSize:16}})}),children:m.filter(e=>e.kind==="videoinput").map(e=>i.jsx(v,{value:e.deviceId,children:e.label||`Camera ${e.deviceId}`},e.deviceId))})}),i.jsx(l,{sx:{width:"32%",display:"flex"},children:i.jsx(g,{size:"small",value:t.audioDeviceId||"",onChange:e=>M(e.target.value),disabled:h,startAdornment:i.jsx(p,{children:i.jsx(L,{sx:{fontSize:16}})}),children:m.filter(e=>e.kind==="audioinput").map(e=>i.jsx(v,{value:e.deviceId,children:e.label||`Microphone ${e.deviceId}`},e.deviceId))})}),i.jsx(l,{sx:{width:"32%",display:"flex"},children:i.jsxs(g,{size:"small",value:t.role,onChange:e=>c(a=>({...a,role:e.target.value})),disabled:h,children:[i.jsx(v,{value:"admin",children:"Admin"}),i.jsx(v,{value:"user",children:"User"})]})})]})]}),i.jsxs(u,{spacing:2,sx:{mt:3,flex:.3},children:[i.jsx(T,{label:"Meeting Token",value:t.token,onChange:e=>c(a=>({...a,token:e.target.value})),fullWidth:!0,placeholder:"Enter meeting token"}),i.jsx(F,{variant:"contained",fullWidth:!0,onClick:E,loading:y,children:"Join Meeting"})]})]})})};export{O as default};
